<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>SPEC-OPS｜Bar SPEC</title>

  <link rel="icon" type="image/png" href="/icon-192.png?v=3" sizes="192x192">
  <link rel="apple-touch-icon" href="/icon-180.png?v=3">
  <link rel="manifest" href="/manifest.json?v=3">

  <meta name="theme-color" content="#c5a059">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="SPEC-OPS">

  <style>
    :root{
      --bg:#0e0c0a; --panel:#1c1915; --panel2:#25211e;
      --accent:#c5a059; --text:#f4f4f4; --muted:#a89984;
      --line:rgba(197,160,89,0.2); --ok:#8fd19e; --ng:#ff8f8f;
      --todo:#ffcc00; --blue:#7da7ff;
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }
    body{
      margin:0; font-family:sans-serif; background:var(--bg); color:var(--text);
      padding-bottom: calc(80px + var(--safe-bottom)); line-height:1.6;
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

    .sticky-header{
      position:sticky; top:0; z-index:1000;
      background:rgba(14,12,10,.95);
      backdrop-filter:blur(10px);
      border-bottom:1px solid var(--line);
      padding-top:var(--safe-top);
    }
    header{ padding:10px 15px; text-align:center; }
    .logo{ font-weight:800; letter-spacing:4px; color:var(--accent); }

    .view-tabs{ display:flex; gap:6px; padding:0 10px 10px; }
    .tab-btn{
      flex:1; padding:12px 0; text-align:center;
      background:var(--panel2); border:1px solid var(--line);
      color:var(--muted); border-radius:8px;
      font-weight:bold; font-size:13px; cursor:pointer;
    }
    .tab-btn.active{ background:var(--accent); color:#000; }
    .tab-btn.active.close-tab{ background:var(--blue); }

    main{ padding:15px; max-width:600px; margin:0 auto; }
    h2{ font-size:13px; color:var(--accent); border-left:3px solid var(--accent); padding-left:10px; }
    .card{ background:var(--panel); border:1px solid var(--line); border-radius:12px; padding:16px; margin-bottom:15px; }
    .hidden{ display:none !important; }

    label{ display:flex; align-items:center; margin:10px 0; font-size:14px; }
    input[type="checkbox"]{ transform:scale(1.4); margin-right:10px; }
    textarea{
      width:100%; padding:12px; border-radius:10px;
      background:#000; color:#fff; border:1px solid #333;
    }
    .send-btn{
      width:100%; padding:18px; border-radius:14px;
      background:var(--accent); border:none;
      font-size:16px; font-weight:800; cursor:pointer;
    }
    .send-btn:disabled{ background:var(--muted); }

    .cash-grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .cash-item{
      display:flex; justify-content:space-between; align-items:center;
      background:#000; border:1px solid #222;
      padding:10px; border-radius:8px;
    }
    .cash-item input{
      width:70px; background:none; border:none; color:#fff;
      text-align:right; font-size:18px;
    }
  </style>
</head>

<body>

<!-- 認証 -->
<div id="auth-overlay" style="position:fixed; inset:0; background:var(--bg); z-index:9999; display:flex; flex-direction:column; justify-content:center; align-items:center;">
  <div class="logo" style="font-size:24px;margin-bottom:20px;">SPEC-OPS</div>
  <input id="staff-name-input" placeholder="スタッフ名" style="width:260px;padding:14px;margin-bottom:10px;">
  <input id="pass-input" type="password" placeholder="Password" style="width:260px;padding:14px;margin-bottom:15px;">
  <button onclick="checkAuth()" style="width:260px;padding:14px;">ENTER SYSTEM</button>
</div>

<div class="sticky-header">
  <header><div class="logo">SPEC-OPS</div></header>
  <div class="view-tabs">
    <div id="tabReport" class="tab-btn active" onclick="switchView('report')">Report</div>
    <div id="tabManual" class="tab-btn" onclick="switchView('manual')">Manual</div>
  </div>
</div>

<main>

<div id="welcome-message"></div>

<!-- REPORT -->
<div id="report-view">

<div class="card">
  <button onclick="setMode('開店')">開店</button>
  <button onclick="setMode('閉店')">閉店</button>
</div>

<form id="openSection" class="card">
<h2>開店チェック</h2>

<label><input type="checkbox">2F トイレ・床・鏡</label>
<label><input type="checkbox">2F テーブル・椅子</label>
<label><input type="checkbox">2F 備品・menu</label>

<label><input type="checkbox">1F トイレ・床・鏡</label>
<label><input type="checkbox">1F カウンター</label>
<label><input type="checkbox">1F キッチン</label>

<label><input type="checkbox">HACCP入力完了</label>
</form>

<div id="closeSection" class="card hidden">
<h2>閉店チェック</h2>
<label><input type="checkbox">エアコンOFF</label>
<label><input type="checkbox">施錠確認</label>
<label><input type="checkbox">レジ締め</label>
</div>

<div class="card">
<h2>金種</h2>
<div class="cash-grid">
<div class="cash-item"><span>1,000</span><input id="n1000" oninput="calc()"></div>
<div class="cash-item"><span>500</span><input id="n500" oninput="calc()"></div>
</div>
<p id="cashResult">合計：0 円</p>
</div>

<div class="card">
<textarea id="comment" placeholder="連絡事項"></textarea>
<button type="button" id="sendBtn" class="send-btn" onclick="sendMail()">報告を送信</button>
</div>

</div>

<!-- MANUAL -->
<div id="manual-view" class="hidden">
<div class="card">
<button onclick="logout()">ログアウト / リセット</button>
</div>
</div>

</main>

<script>
const STAFF_PASS="spec1234";
let currentMode="開店";

function checkAuth(){
  if(document.getElementById("pass-input").value===STAFF_PASS){
    localStorage.setItem("spec_auth_granted","true");
    localStorage.setItem("spec_staff_name",document.getElementById("staff-name-input").value);
    document.getElementById("auth-overlay").style.display="none";
  }else alert("認証失敗");
}

function switchView(v){
  document.getElementById("report-view").classList.toggle("hidden",v!=="report");
  document.getElementById("manual-view").classList.toggle("hidden",v!=="manual");
}

function setMode(m){
  currentMode=m;
  document.getElementById("openSection").classList.toggle("hidden",m!=="開店");
  document.getElementById("closeSection").classList.toggle("hidden",m!=="閉店");
}

function calc(){
  const t=(Number(n1000.value||0)*1000)+(Number(n500.value||0)*500);
  cashResult.textContent=`合計：${t.toLocaleString()} 円`;
}

async function sendMail(){
  alert("送信OK（API接続待ち）");
}

function logout(){
  localStorage.clear();
  if("serviceWorker" in navigator){
    navigator.serviceWorker.getRegistrations().then(r=>r.forEach(x=>x.unregister()));
  }
  location.reload();
}

window.onload=()=>{
  if(localStorage.getItem("spec_auth_granted")==="true"){
    document.getElementById("auth-overlay").style.display="none";
  }
};

if("serviceWorker" in navigator){
  navigator.serviceWorker.register("/sw.js");
}
</script>

</body>
</html>
